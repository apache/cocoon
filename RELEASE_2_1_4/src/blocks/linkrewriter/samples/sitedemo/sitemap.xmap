<?xml version="1.0"?>

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

<!-- =========================== Components ================================ -->

 <map:components>
  <map:generators default="file"/>
  <map:transformers default="xslt">
    <map:transformer name="linkrewriter"
      src="org.apache.cocoon.transformation.LinkRewriterTransformer">
      <input-module name="linkmap">
        <file src="{src}" reloadable="true"/>
      </input-module>
      <input-module name="site">
        <input-module name="linkmap">
          <file src="{src}" reloadable="true"/>
        </input-module>
        <prefix>/site/</prefix>
        <suffix>/@href</suffix>
      </input-module>
    </map:transformer>
  </map:transformers>
  <map:readers default="resource"/>
  <map:serializers default="html"/>
  <map:matchers default="wildcard"/>
  <map:selectors default="browser"/>
 </map:components>

<!-- =========================== Pipelines ================================= -->

 <map:pipelines>
   <map:pipeline>

     <map:match pattern="">
       <map:redirect-to uri="welcome"/>
     </map:match>

     <map:match pattern="**welcome">
       <map:generate src="docs/index.xml"/>
       <!-- Uses {src} and {prefix} var interpolation -->
       <map:transform type="linkrewriter" src="cocoon:/{1}linkmap">
         <map:parameter name="prefix" value="/site/"/>
       </map:transform>
       <map:serialize type="xml"/>
     </map:match>

     <map:match pattern="abs-linkmap">
       <map:generate src="linkmap.xml"/>
       <map:transform src="../stylesheets/absolutize-linkmap.xsl"/>
       <map:serialize type="xml"/>
     </map:match>

     <map:match pattern="**linkmap">
       <map:generate src="linkmap.xml"/>
       <map:transform src="../stylesheets/absolutize-linkmap.xsl"/>
       <map:transform src="../stylesheets/relativize-linkmap.xsl">
         <map:parameter name="path" value="{0}"/>
       </map:transform>
       <map:serialize type="xml"/>
     </map:match>

   </map:pipeline>
 </map:pipelines>

</map:sitemap>

<!-- end of file -->
