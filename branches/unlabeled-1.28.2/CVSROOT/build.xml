<?xml version="1.0"?>

<project default="compile" basedir=".">

    <property name="name" value="Cocoon"/>
    <property name="vers" value="2.0-alpha0"/>

    <property name="build.dir" value="./build"/>
    <property name="build.src" value="./build/src"/>
    <property name="build.bin" value="./build/bin"/>

    <property name="src" value="./src"/>
    <property name="bin" value="./bin"/>
    <property name="jar" value="./${bin}/${name}-${vers}.jar"/>

    <target name="prepare">
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${build.src}"/>
        <mkdir dir="${build.bin}"/>
        <copydir src="${src}" dest="${build.src}" ignore="package.html"/>
    </target>

    <target name="prepare-with-jsdk2.2" depends="prepare">
       <delete file="${build.src}/org/apache/cocoon/servlet/CocoonServletRequest.java"/>
       <delete file="${build.src}/org/apache/cocoon/servlet/CocoonServletResponse.java"/>
       <copyfile src="${src}/org/apache/cocoon/servlet/CocoonServletRequest.java.Servlet22" 
                 dest="${build.src}/org/apache/cocoon/servlet/CocoonServletRequest.java"/>
       <copyfile src="${src}/org/apache/cocoon/servlet/CocoonServletResponse.java.Servlet22" 
                 dest="${build.src}/org/apache/cocoon/servlet/CocoonServletResponse.java"/>
    </target>

    <target name="compile" depends="prepare">
        <javac srcdir="${build.src}" destdir="${build.bin}"/>
    </target>

    <target name="compile-with-jsdk2.2" depends="prepare-with-jsdk2.2, compile">
      <echo message="compiled with jsdk2.2"/>
    </target>

    <target name="package" depends="compile">
        <mkdir dir="${bin}"/>
        <jar jarfile="${jar}" basedir="${build.bin}" items="org"/>
    </target>

    <target name="package-with-jsdk2.2" depends="compile-with-jsdk2.2">
        <mkdir dir="${bin}"/>
        <jar jarfile="${jar}" basedir="${build.bin}" items="org"/>
    </target>

    <target name="clean">
        <deltree dir="${build.dir}"/>
    </target>

    <target name="distclean" depends="clean">
        <deltree dir="${bin}"/>
    </target>

</project>
