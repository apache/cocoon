<?xml version="1.0" encoding="utf-8"?>

<project name="flowscriptReload" default="flowscriptReload">

  <group id="default">
    <property name="usetidy" value="true"/>
  </group>

  <!-- Check the reloading of the sitemap -->
  <target name="flowscriptReload">
    <property name="test-dir" value="samples/flow/test"/>
    <property name="url" value="${cocoon}/${test-dir}/showString"/>

    <!--+
        | Copy the flowscript from its source directory to the destination
        | area, and replace the parameter value with 'abc' 
        +-->

    <copy file="${src-webapp-dir}/${test-dir}/sendpage.js"
	  tofile="${deploy-dir}/${test-dir}/sendpage.js"
	  overwrite="yes">
      <filterset>
        <filter token="REPLACEME" value="replaceme-abc"/>
      </filterset>
    </copy>

    <!-- make sure change is detected -->
    <sleep seconds="1"/>

    <httpRequest href="${url}" description="Send original request">
      <match>
        <xpath select="html/body/p[1]" pattern=".*replaceme-abc.*"/>
      </match>
    </httpRequest>

    <!--+ 
        | Copy the flowscript from its source directory to the destination
        | area, and replace the parameter value with '123' 
        +-->

    <copy file="${src-webapp-dir}/${test-dir}/sendpage.js"
	  tofile="${deploy-dir}/${test-dir}/sendpage.js"
	  overwrite="yes">
      <filterset>
	    <filter token="REPLACEME" value="replaceme-123"/>
      </filterset>
    </copy>

    <!-- make sure change is detected -->
    <sleep seconds="1"/>

    <httpRequest href="${url}" description="Send next request after flowscript was modified">
      <match>
        <xpath select="html/body/p[1]" pattern=".*replaceme-123.*"/>
      </match>
    </httpRequest>

  </target>
</project>
