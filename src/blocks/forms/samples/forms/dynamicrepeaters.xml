<?xml version="1.0"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!--
  @version $Id: dynamicrepeater.xml 385334 2006-03-12 18:27:44Z sylvain $
-->

<fd:form xmlns:fd="http://apache.org/cocoon/forms/1.0#definition"
         xmlns:i18n="http://apache.org/cocoon/i18n/2.1" id="form">

  <fd:widgets>

    <!-- 1st repeater, a DND Source  
          orderable="true" - this repeater may have it's rows rearranged via DnD
          dndAllow - missing, using default value, meta-keys will be used to determine copy/move behaviour
          rowType="family" - rows from the repeater may be droped on another repeater that declares eg. acceptType="family"
          acceptType - missing, you cannot drop anything on this repeater from another one
    -->
    <fd:repeater id="contacts1" orderable="true" rowType="family">
      <fd:widgets>

        <!-- The ID is here to keep track of row creation order, which can
            have no relation with row index when the users used move up/down
            and even less if they clone a row
         -->
        <fd:output id="ID">
          <fd:label>ID</fd:label>
          <fd:datatype base="integer"/>
        </fd:output>

        <fd:field id="firstname">
          <fd:label>Firstname</fd:label>
          <fd:hint>Your family member's first name</fd:hint>
          <fd:datatype base="string"/>
        </fd:field>

        <fd:field id="lastname">
          <fd:label>Lastname</fd:label>
          <fd:hint>Your family member's last name</fd:hint>
          <fd:datatype base="string"/>
        </fd:field>

        <fd:booleanfield id="select">
          <fd:label>Select</fd:label>
        </fd:booleanfield>

      </fd:widgets>
    </fd:repeater>

    <fd:repeater-action id="removecontacts1" command="delete-rows" repeater="contacts1" select="select">
      <fd:label>Remove selected</fd:label>
    </fd:repeater-action>

    <fd:repeater-action id="addcontact1" command="add-row" repeater="contacts1">
      <fd:label>Add Family</fd:label>
      <fd:on-action>
        <fd:javascript>
          // Increment the row creation ID counter (it has been initialized in
          // the flowscript when the form was created).
          // This shows how attributes can be used as a communication means between
          // application logic and widget event handlers.
          var form = event.source.form;
          var count = new java.lang.Integer(form.getAttribute("counter1").intValue() + 1);
          form.setAttribute("counter1", count);
          var repeater = form.getChild("contacts1");
          repeater.getRow(repeater.getSize() - 1).getChild("ID").setValue(count);
        </fd:javascript>
      </fd:on-action>
    </fd:repeater-action>
    
    <!-- 2nd repeater, a DND Source 
          orderable="true" - this repeater may have it's rows rearranged via DnD
          dndAllow="move, copy" - internal drags can only move, external drags can only copy (meta-keys ignored)
          rowType="friends" - rows from the repeater may be droped on another repeater that declares eg. acceptType="friends"
          acceptType - missing, you cannot drop anything on this repeater from another one
    -->
    <fd:repeater id="contacts2" orderable="true" dndAllow="move, copy" rowType="friends">
      <fd:widgets>

        <!-- The ID is here to keep track of row creation order, which can
            have no relation with row index when the users used move up/down -->
        <fd:output id="ID">
          <fd:label>ID</fd:label>
          <fd:datatype base="integer"/>
        </fd:output>

        <fd:field id="firstname">
          <fd:label>Firstname</fd:label>
          <fd:hint>Your friend's first name</fd:hint>
          <fd:datatype base="string"/>
        </fd:field>

        <fd:field id="lastname">
          <fd:label>Lastname</fd:label>
          <fd:hint>Your friend's last name</fd:hint>
          <fd:datatype base="string"/>
        </fd:field>

        <fd:booleanfield id="select">
          <fd:label>Select</fd:label>
        </fd:booleanfield>
      </fd:widgets>
    </fd:repeater>

    <fd:repeater-action id="removecontacts2" command="delete-rows" repeater="contacts2" select="select">
      <fd:label>Remove selected</fd:label>
    </fd:repeater-action>

    <fd:repeater-action id="addcontact2" command="add-row" repeater="contacts2">
      <fd:label>Add Friend</fd:label>
      <fd:on-action>
        <fd:javascript>
          // Increment the row creation ID counter (it has been initialized in
          // the flowscript when the form was created).
          // This shows how attributes can be used as a communication means between
          // application logic and widget event handlers.
          var form = event.source.form;
          var count = new java.lang.Integer(form.getAttribute("counter2").intValue() + 1);
          form.setAttribute("counter2", count);
          var repeater = form.getChild("contacts2");
          repeater.getRow(repeater.getSize() - 1).getChild("ID").setValue(count);
        </fd:javascript>
      </fd:on-action>
    </fd:repeater-action>

    <!-- 3rd repeater, the DND Target 
          orderable="true" - this repeater may have it's row rearranged
          dndAllow="move" - drags can only move (meta-keys ignored)
          rowType - missing, no other repeater will accept rows from this repeater
          acceptType="one, two" - you can drop rows from repeaters with a matching @rowType ("one" or "two") 
    -->
    <fd:repeater id="contacts3" orderable="true" dndAllow="move" acceptType="family, friends">
      <fd:widgets>

        <!-- The ID is here to keep track of row creation order, which can
            have no relation with row index when the users used move up/down -->
        <fd:output id="ID">
          <fd:datatype base="integer"/>
        </fd:output>

        <fd:output id="firstname">
          <fd:datatype base="string"/>
        </fd:output>

        <fd:output id="lastname">
          <fd:datatype base="string"/>
        </fd:output>

        <fd:booleanfield id="select"/>
      </fd:widgets>
    </fd:repeater>

    <fd:repeater-action id="removecontacts3" command="delete-rows" repeater="contacts3" select="select">
      <fd:label>Remove selected</fd:label>
    </fd:repeater-action>

    <fd:submit id="ok">
      <fd:label>Print</fd:label>
    </fd:submit>
  </fd:widgets>
</fd:form>
