<?xml version="1.0"?>

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

<!-- =========================== Components ================================ -->

 <map:components>
  <map:generators default="file"/>
  <map:transformers default="xslt">
    <map:transformer name="linkrewriter"
      src="org.apache.cocoon.transformation.LinkRewriterTransformer">
      <input-module name="book-raw">
        <file src="cocoon://samples/linkrewriter/bookdemo/linkmap" reloadable="true"/>
      </input-module>
      <input-module name="book">
        <input-module name="book-raw">
          <file src="{src}" reloadable="true"/>
        </input-module>
        <prefix>//*[@label='</prefix>
        <suffix>']/@href</suffix>
      </input-module>
    </map:transformer>
  </map:transformers>
  <map:readers default="resource"/>
  <map:serializers default="html"/>
  <map:matchers default="wildcard"/>
  <map:selectors default="browser"/>
 </map:components>

<!-- =========================== Pipelines ================================= -->

 <map:pipelines>
   <map:pipeline>

     <map:match pattern="">
       <map:redirect-to uri="index.html"/>
     </map:match>

     <map:match pattern="*.html">
       <map:generate src="docs/{1}.html"/>
       <map:transform type="linkrewriter" src="cocoon:/linkmap">
         <!--
         <map:parameter name="prefix" value="//*[@label='"/>
         <map:parameter name="suffix" value="']/@href"/>
         -->
       </map:transform>
       <map:serialize/>
       <map:serialize type="xml"/>
     </map:match>

     <map:match pattern="**/*.html">
       <map:generate src="docs/{1}/{2}.html"/>
       <map:transform type="linkrewriter" src="cocoon:/{1}/linkmap"/>
       <map:serialize/>
       <map:serialize type="xml"/>
     </map:match>

     <map:match pattern="**linkmap">
       <map:generate src="docs/book.xml"/>
       <map:transform src="stylesheets/absolutize-linkmap.xsl"/>
       <map:transform src="stylesheets/relativize-linkmap.xsl">
         <map:parameter name="path" value="{0}"/>
       </map:transform>
       <map:serialize type="xml"/>
     </map:match>

   </map:pipeline>
 </map:pipelines>

</map:sitemap>
