<?xml version="1.0"?>

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

<!-- =========================== Components ================================ -->

 <map:components>
   <map:generators default="file">
     <map:generator name="search"
        src="org.apache.cocoon.generation.SearchGenerator"
        label="content"/>
   </map:generators>
   <map:transformers default="xslt">
     <map:transformer name="log"
       src="org.apache.cocoon.transformation.LogTransformer"/>
     <map:transformer name="index" 
       logger="sitemap.transformer.luceneindextransformer" 
       src="org.apache.cocoon.transformation.LuceneIndexTransformer"/>
   </map:transformers>

   <map:readers default="resource"/>
   <map:serializers default="html"/>
   <map:matchers default="wildcard"/>
   <map:selectors default="browser"/>
   <map:actions>
<!-- FIXME: Has this action moved somewhere else?
     <map:action name="lang-select" src="org.apache.cocoon.acting.LangSelect"/>
-->
     <map:action name="locale" src="org.apache.cocoon.acting.LocaleAction"/>
     <map:action name="request"
        src="org.apache.cocoon.acting.RequestParamAction"/>
     <map:action name="form-validator"
        src="org.apache.cocoon.acting.FormValidatorAction"/>
     <map:action name="resource-exists"
        src="org.apache.cocoon.acting.ResourceExistsAction"/>
   </map:actions>
</map:components>

<!-- =========================== Views =================================== -->

<map:views>
  <map:view name="content" from-label="content">
   <map:serialize type="xml"/>
  </map:view>

  <map:view from-label="content" name="pretty-content">
   <map:transform src="context://stylesheets/system/xml2html.xslt"/>
   <map:serialize type="html"/>
  </map:view>

  <map:view name="links" from-position="last">
   <map:serialize type="links"/>
  </map:view>

</map:views>


<!-- =========================== Pipelines ================================= -->

<map:pipelines>
  
  <map:pipeline>
    <map:match pattern="images/*.gif">
      <map:read src="images/{1}.gif" mime-type="image/gif">
        <map:parameter name="expires" value="60000"/>
      </map:read>
    </map:match>

    <map:match pattern="findIt">
      <map:generate type="search"/>
      <map:transform type="log"/>
      <map:transform src="stylesheets/search2html.xsl"/>
      <map:serialize/>
    </map:match>

    <map:match pattern="findIt2">
      <map:generate type="search">
        <map:parameter name="index" value="index2"/>
      </map:generate>
      <map:transform type="log"/>
      <map:transform src="stylesheets/search-index2html.xsl"/>
      <map:serialize/>
    </map:match>

    <map:match pattern="document-files.xsp">
      <map:generate type="serverpages" src="document-files.xsp">
      </map:generate>

      <map:transform src="stylesheets/all-files2content.xsl"/>
      <map:transform type="cinclude"/>
      <map:transform src="stylesheets/content2lucene.xsl"/>
      <map:transform type="index"/>

      <map:transform src="stylesheets/lucene-index2html.xsl"/>

      <map:serialize/>
    </map:match>

    <map:match pattern="*.xsp">
      <map:generate type="serverpages" src="{1}.xsp">
        <map:parameter name="p1" value="context://docs/xdocs"/>
      </map:generate>

      <map:serialize type="xml"/>
    </map:match>
    
    <map:match pattern="*">
      <map:generate type="serverpages" src="{1}-index.xsp"/>
      <!--
        Run-time configuration is done through these
        <map:parameter/> elements. Again, let's have a look at the
        javadocs:
        "[...] All <map:parameter> declarations will be made
        available in the XSLT stylesheet as xsl:variables. [...]" 
      -->
      <map:transform src="context://samples/stylesheets/dynamic-page2html.xsl">
          <map:parameter name="contextPath" value="{request:contextPath}"/>
      </map:transform>
      <map:serialize/>
    </map:match>

  </map:pipeline>
</map:pipelines>

</map:sitemap>
