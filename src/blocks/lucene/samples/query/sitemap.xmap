<?xml version="1.0"?>
<!--
  Copyright 1999-2004 The Apache Software Foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

<!-- =========================== Components =================================== -->

	<map:components>
		<map:transformers default="xalan">
			<map:transformer name="i18n" src="org.apache.cocoon.transformation.I18nTransformer">
				<catalogues default="forms">
					<catalogue id="local" name="messages" location="screens"/>
					<catalogue id="forms" name="FormsMessages" location="context://samples/blocks/forms/messages"/>
				</catalogues>
				<cache-at-startup>true</cache-at-startup>
			</map:transformer>
		</map:transformers>
		<map:pipes default="caching"/>
	</map:components>

<!-- =========================== FlowScripts =================================== -->

	<map:flow language="javascript">
		<map:script src="query.js"/>
	</map:flow>

<!-- =========================== Views =================================== -->

<map:views>
  <map:view name="content" from-label="content">
   <map:serialize type="xml"/>
  </map:view>

  <map:view from-label="content" name="pretty-content">
   <map:transform src="context://stylesheets/system/xml2html.xslt"/>
   <map:serialize type="html"/>
  </map:view>

  <map:view name="links" from-position="last">
   <map:serialize type="links"/>
  </map:view>

</map:views>

<!-- =========================== Pipelines ================================= -->

<map:pipelines>

		<map:pipeline internal-only="true">
		
			<map:act type="locale">
			
				<!-- displays the forms -->
				<map:match pattern="form/*">
					<map:generate type="jx" src="screens/{1}-template.xml"/>
					<map:transform type="forms">
						<map:parameter name="locale" value="{../locale}"/>  
					</map:transform>
					<map:transform type="i18n">
						<map:parameter name="locale" value="{../locale}"/>  
					</map:transform>
					<map:transform src="context://samples/blocks/forms/resources/forms-samples-styling.xsl"/>
					<map:transform src="context://samples/common/style/xsl/html/simple-page2html.xsl">
						<map:parameter name="contextPath" value="{request:contextPath}"/>
					</map:transform>
					<map:serialize/>
				</map:match>
	
				<!-- displays the screens -->
				<map:match pattern="screen/*">
					<map:generate type="jx" src="screens/{1}.xml"/>
					<map:transform type="i18n">
						<map:parameter name="locale" value="{../locale}"/>  
					</map:transform>
					<map:transform src="context://samples/common/style/xsl/html/simple-page2html.xsl">
						<map:parameter name="contextPath" value="{request:contextPath}"/>
					</map:transform>
					<map:serialize/>
				</map:match>
				
			</map:act>

		</map:pipeline>
  
		<map:pipeline>

			<!--					
			 Used for CForms Continuations
			
			 must be placed before external page pipelines
			 and after internal screen pipelines
			 otherwise you get infinite loops					 
			-->				
			<map:match type="request-parameter" pattern="continuation-id">
				<map:call continuation="{1}"/>
			</map:match>

			<!-- home page -->
    	<map:match pattern="">
    		<map:redirect-to uri="cocoon:/screen/index"/>
      </map:match>

			<!-- history page -->
			<map:match pattern="history.html">
				<map:call function="history">
					<map:parameter name="screen" value="screen/history"/> 									<!-- the history screen cocoon:/ pipeline -->
				</map:call>
			</map:match>

			<!-- searches -->
			<map:match pattern="*.html">
				<map:call function="simpleLuceneQuery">
					<map:parameter name="form-definition" value="screens/{1}-model.xml"/> 	<!-- the editing form definition file -->
					<map:parameter name="bindingURI" value="screens/{1}-binding.xml"/> 			<!-- the editing form binding file -->
					<map:parameter name="form" value="form/{1}"/> 													<!-- the editing form cocoon:/ pipeline -->
					<map:parameter name="type" value="{1}"/> 																<!-- the query type -->
					<map:parameter name="lucene-directory" value="index2"/> 								<!-- the lucene index -->
					<map:parameter name="screen" value="screen/results"/> 									<!-- the search results cocoon:/ pipeline -->
					<map:parameter name="query" value="{request-param:query}"/> 						<!-- the query param (for quick queries) -->
					<map:parameter name="id" value="{request-param:id}"/> 									<!-- the history id param -->
					<map:parameter name="page" value="{request-param:page}"/> 							<!-- the page param -->
				</map:call>
			</map:match>

			<!-- used in the docs, to show files -->
			<map:match pattern="**.xml">
				<map:generate src="{1}.xml"/>
				<map:serialize type="xml"/>
			</map:match>

		</map:pipeline>
	</map:pipelines>

</map:sitemap>
