<?xml version="1.0"?>
<!-- minimal sitemap for Cocoon 2 -->
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
    <!-- ======= Components ======= -->
    
    
 <map:components>
  <map:generators   default="file"/>
  <map:transformers default="xslt"/>
  <map:readers      default="resource"/>
  <map:serializers  default="html"/>
  <map:matchers     default="wildcard"/>
  <map:selectors    default="browser">
    <map:selector name="resource-exists"
               logger="sitemap.selector.resource-exists"
               src="org.apache.cocoon.selection.ResourceExistsSelector" />  
   </map:selectors>
  <map:actions >
       <map:action logger="sitemap.action.request" name="request" src="org.apache.cocoon.acting.RequestParamAction"/>
  </map:actions>
 
  <map:pipes        default="caching"/>
 </map:components>


    <map:views>
        <map:view name="aggregate" from-label="aggregate">
            <map:serialize type="xml"/>
        </map:view>
    </map:views>

    <!-- ======= Pipelines ======= -->
    <map:pipelines>


        <map:pipeline>

    
            <map:match pattern="testmatch01">
                <map:select type="resource-exists">
                   <map:when test="SitemapInfo/images/{1}_{2}.gif">
                 <map:generate src="cocoon:/{1}.xmap"/>
                 <map:transform src="transforms/sitemap2descr01.xsl">
                     <map:parameter name="location" value="{1}"/>
                 </map:transform>
                 <map:transform src="transforms/sitemap2descr02.xsl"/>
                 <map:serialize type="xml"/>
                   </map:when>
                   <map:when test="images/{1}_{2}.gif">
                      <map:read src="cocoon:/hoep/../vla/flip/../../index.html" mime-type="text/html"/>
                   </map:when>
                   <map:when test="images/{1}_{2}.gif">
                      <map:read src="images/{1}_{2}.gif" mime-type="image/gif"/>
                   </map:when>
                   <map:when test="true">
                    <map:aggregate element="index">
                        <map:part element="files" src="cocoon:/dirlinks.xml"/>
                        <map:part element="introhtml" src="html/intro.xml" strip-root="yes"/>
                    </map:aggregate>
                      <!--map:serialize type="xml"/-->
                      <map:transform src="transforms/sitemaplist2index.xsl"/>
                      <map:serialize type="html"/>
                   </map:when>
                   <map:otherwise>
                        <map:redirect-to uri="index.html"/>
                   </map:otherwise>
                </map:select>
            </map:match>

            <map:match pattern="testmatch02">
                <map:aggregate element="index">
                    <map:part element="files" src="cocoon:/dirlinks.xml"/>
                    <map:part element="introhtml" src="html/intro.xml" strip-root="yes"/>
                </map:aggregate>
                  <!--map:serialize type="xml"/-->
                  <map:transform src="transforms/sitemaplist2index.xsl"/>
                <map:select type="browser">
                    <map:when test="explorer">
                    </map:when>
                    <map:when test="mozilla5">
                    </map:when>
                    <map:otherwise>
                        <map:transform src="transforms/kill-dynamic.xsl"/>
                    </map:otherwise>
                </map:select>

                  <map:serialize type="html"/>
            </map:match>

            <map:match pattern="*_*.gif">
                <map:select type="resource-exists">
                   <map:when test="SitemapInfo/images/{1}_{2}.gif">
                      <map:read src="images/{1}_{2}.gif" mime-type="image/gif"/>
                   </map:when>
                   <map:when test="images/{1}_{2}.gif">
                      <map:read src="images/{1}_{2}.gif" mime-type="image/gif"/>
                   </map:when>
                   <map:otherwise>
                      <map:read src="images/default_{2}.gif" mime-type="image/gif"/>
                   </map:otherwise>
                </map:select>
            </map:match>

        </map:pipeline>

        <map:pipeline >
            <map:match pattern="">
                <map:redirect-to uri="index.html"/>
            </map:match>
        </map:pipeline >


        <map:pipeline internal-only="false">
            
            <map:match pattern="**.descr01">
                 <map:generate src="cocoon:/{1}.xmap"/>
                 <map:transform src="transforms/sitemap2descr01.xsl">
                     <map:parameter name="location" value="{1}"/>
                 </map:transform>
                 <!--map:transform src="transforms/sitemap2descr02.xsl"/-->
                 <map:serialize type="xml"/>
            </map:match>

            <map:match pattern="**.descr">
                 <map:generate src="cocoon:/{1}.descr01"/>
                 <map:transform src="transforms/sitemap2descr02.xsl"/>
                 <map:serialize type="xml"/>
            </map:match>


            <map:match pattern="sitemap.xmap">
                <map:act type="request">
                     <map:parameter name="parameters" value="true"/>
                     <map:generate src="../{location}/sitemap.xmap"/>
                    <map:transform src="context://stylesheets/system/xml2html.xslt"/>
                     <map:serialize />
                 </map:act>
            </map:match>

            <map:match pattern="descr">
                <map:act type="request">
                     <map:parameter name="parameters" value="true"/>
                     <map:generate src="cocoon:/{location}.descr"/>
                     <map:serialize type="xml"/>
                 </map:act>
            </map:match>

            <map:match pattern="**/sitemap.xmap">
                <map:act type="request">
                    <map:parameter name="parameters" value="true"/>
                    <map:redirect-to uri="../sitemap.xmap?location={location}"/>
                 </map:act>
            </map:match>
            
            <map:match pattern="**/descr">
                <map:act type="request">
                    <map:parameter name="parameters" value="true"/>
                    <map:redirect-to uri="../descr?location={location}"/>
                 </map:act>
            </map:match>
            
            <map:match pattern="**.xmap">
                 <map:generate src="../{1}/sitemap.xmap"/>
                 <map:serialize type="xml"/>
            </map:match>


        </map:pipeline >


        <map:pipeline >
    
            <map:match pattern="**/*.gif">
                <map:read mime-type="image/gif" src="cocoon:/{2}.gif"/>
            </map:match>

            <map:match pattern="*.gif">
                <map:select type="resource-exists">
                   <map:when test="SitemapInfo/images/{1}.gif">
                      <map:read src="images/{1}.gif" mime-type="image/gif"/>
                   </map:when>
                   <map:when test="images/{1}.gif">
                      <map:read src="images/{1}.gif" mime-type="image/gif"/>
                   </map:when>
                   <map:otherwise>
                      <map:read src="images/default.gif" mime-type="image/gif"/>
                   </map:otherwise>
                </map:select>
            </map:match>

            <map:match pattern="**/*.js">
                <map:read mime-type="text/javascript" src="scripts/{2}.javascript"/>
            </map:match>

            <map:match pattern="*.js">
                <map:read mime-type="text/javascript" src="scripts/{1}.javascript"/>
            </map:match>

            <map:match pattern="**/*.css">
                <map:read mime-type="text/css" src="styles/{2}.css"/>
            </map:match>

            <map:match pattern="*.css">
                <map:read mime-type="text/css" src="styles/{1}.css"/>
            </map:match>

            <map:match pattern="dirlinks.xml">
                        <map:generate type="directory" src=".." >
                            <map:parameter name="depth" value="20"/>
                        </map:generate>
                        <map:transform src="transforms/sitemaplinks.xsl"/>
                        <map:serialize type="xml"/>
            </map:match>
            
            <map:match pattern="index.html">
                    <map:generate src="html/intro.xml" />
                  <map:transform src="transforms/sitemaplist2index.xsl"/>
                  <map:serialize type="html"/>
              </map:match>

            <map:match pattern="index-list.html">
                <map:aggregate element="index">
                    <map:part element="files" src="cocoon:/dirlinks.xml"/>
                    <map:part element="introhtml" src="html/intro.xml" strip-root="yes"/>
                </map:aggregate>
                  <map:transform src="transforms/sitemaplist2index.xsl"/>
                  <map:serialize type="html"/>
              </map:match>

            <map:match pattern="**/sitemap-list.html">
                <map:redirect-to uri="../sitemap-list.html"/>
              </map:match>

            <map:match pattern="sitemap-list.html">
                <map:generate src="cocoon:/dirlinks.xml"/>
                  <map:transform src="transforms/sitemaplist2index.xsl"/>
                  <map:serialize type="html"/>
              </map:match>

            <map:match pattern="*.html">
                <map:aggregate element="html">
                    <map:part element="head" src="html/head.xml" strip-root="yes"/>
                    <map:part element="body" src="html/{1}.xml" strip-root="yes"/>
                </map:aggregate>
                <map:serialize type="html"/>
            </map:match>

            <map:match pattern="dir.xml">
                <map:generate type="directory" src=".." >
                    <map:parameter name="depth" value="20"/>
                  </map:generate>
                  <map:serialize type="xml"/>
              </map:match>
            
            
            <map:match pattern="**">
                <map:generate src="cocoon:/{1}.descr"/>
                <map:transform src="transforms/sitemapdescr2html.xsl">
                    <map:parameter name="showsources" value="0"/>
                </map:transform>
                
                <map:select type="browser">
                    <map:when test="explorer">
                    </map:when>
                    <map:when test="mozilla5">
                    </map:when>
                    <map:otherwise>
                        <map:transform src="transforms/kill-dynamic.xsl"/>
                    </map:otherwise>
                </map:select>

                <map:serialize type="html"/>
            </map:match>


        </map:pipeline >


    </map:pipelines>
</map:sitemap>
