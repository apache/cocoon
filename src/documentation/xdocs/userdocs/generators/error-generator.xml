<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 1999-2004 The Apache Software Foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.0//EN" "../../dtd/document-v10.dtd">

<document>
 <header>
  <title>Notifying Generator</title>
  <version>0.9</version>
  <type>Technical document</type>
  <authors>
    <person name="Bernhard Huber" email="berni_huber@a1.net"/>
  </authors>
  <abstract>This document describes the Notifying Generator of Cocoon.</abstract>
 </header>
 <body>
  <s1 title="Notifying Generator">
   <p>
    The notifying generator creates XML content describing an error condition.
    When an error occurs in a pipeline with a defined an error handler, the
    sitemap manager activates the error generator, feeding it the cause of
    the error. 
   </p>
   <ul>
    <li>Name : &lt;notifier&gt;</li>
    <li>Class: org.apache.cocoon.sitemap.NotifyingGenerator</li>
    <li>Cacheable: No.</li>
    <li>Mode: Sitemap internal</li>
   </ul>
  </s1>
  <s1 title="DTD">
   <p>
    XML generated by notifying generator uses the 
    namespace <code>http://apache.org/cocoon/error/2.0</code> and
    the <code>error</code> prefix.
   </p>
   <p>
    Usually the error condition is described by a throwable object.
    The information of this throwable object is used by the
    error generator to produce the xml content.
    The various elements of the xml content include the following.
   </p>
   <ul>
    <li>
     The element <code>notify</code> is the root element, having
     attributes <code>type</code> and <code>sender</code>.
     The attribute <code>type</code> has fixed value <code>error</code>.
     The attribute <code>sender</code> describes the sender of the
     error notification object. In the current implementation, it has 
     fixed value <code>org.apache.cocoon.sitemap.ErrorNotifier</code>.
    </li>
    <li>
     The element <code>title</code> stores the title of the eror notification.
     In the current implementation, it has fixed value <code>Cocoon error</code>.
    </li>
    <li>
     The <code>source</code> element stores the class name of the throwable object
     of the error notification.
    </li>
    <li>
     The <code>message</code> element stores the <code>getMessage()</code> result 
     of the throwable object of the error notification, and may be empty.
    </li>
    <li>
     The <code>description</code> element stores the <code>toString()</code> result 
     of the throwable object of the error notification.
    </li>
    <li>
     Optional <code>extra</code> elements stores nested exceptions
     of the throwable object of the error notification.
    </li>
   </ul>
   <source><![CDATA[
<!ELEMENT notify (title, source, message, description, extra*)>
<!ATTLIST notiy 
  type CDATA #REQUIRED
  sender CDATA #REQUIRED
>
<!ELEMENT title #PCDATA>
<!ELEMENT source #PCDATA>
<!ELEMENT message #PCDATA>
<!ELEMENT description #PCDATA>
<!ELEMENT extra #PCDATA>
<!ATTLIST extra description #CDATA>
<!ELEMENT statusinfo (group|value)*>
]]></source>
  </s1>
  <s1 title="Example">
   <p>
    The following example outputs the xml content of 
    an error generator:
   </p>
   <source><![CDATA[
<?xml version="1.0"
 encoding="UTF-8"?>
 
<error:notify
 error:type="error" 
 error:sender="org.apache.cocoon.sitemap.ErrorNotifier"
 xmlns:error="http://apache.org/cocoon/error/2.0">
 
 <error:title>Cocoon error</error:title>
 <error:source>java.lang.NullPointerException</error:source>
 <error:message></error:message>
 <error:description></error:description>
 <error:extra description=""></error:extra>
</error:notify>
]]></source>
  </s1>
 </body>
</document>
