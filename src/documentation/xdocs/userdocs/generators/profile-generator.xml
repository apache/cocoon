<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.0//EN" "../../dtd/document-v10.dtd">

<document>
  <header>
    <title>Profile Generator</title>
    <version>0.9</version>
    <type>Technical document</type>
    <authors>
      <person name="Carsten Ziegeler" email="cziegeler@apache.org"/>
    </authors>
    <abstract>This document describes the profile generator of 
Cocoon.</abstract>
  </header>
  <body>
    <s1 title="Profile Generator">
      <p>
        The profile generator creates xml from the current profiler 
measurement 
        results of cocoon.
      </p>
      <p>
        The information is surrounded by the root element 
<code>profilerinfo</code>
        and grouped with the elements <code>pipeline</code>, 
        <code>average</code>, <code>result</code> and 
<code>element</code>.
      </p>
      <p>
        The <code>profilerinfo</code> element has the attribute 
<code>date</code>.
        The <code>pipeline</code> element has the attributes 
          <code>uri</code>, <code>count</code> and <code>time</code>.
        The <code>average</code> element has the attribute
          <code>time</code>.
        The <code>element</code> element has the attributes 
          <code>role</code>, <code>source</code> and <code>time</code>.
      </p>
      <p>
        A <code>pipeline</code> summarizes profile information of a 
pipeline
        as specified in the <code>sitemap</code>.
        Each <code>pipeline</code> element consists of 
        an <code>average</code>, and a <code>result</code> element.
        The <code>average</code> element describes the average time 
values, 
        whereas the <code>result</code> element describes each pipeline 
processing.
      </p>
      <p>
        The <code>element</code> element describes the timing values 
for each stage of
        the pipeline processing.
      </p>
      <p>
        All elements have the namespace 
        <code>http://apache.org/cocoon/profiler/1.0</code>.
      </p>
      <ul>
        <li>Name : profile</li>
        <li>Class: 
org.apache.cocoon.components.profiler.ProfilerGenerator</li>
        <li>Cacheable: no.</li>
      </ul>
      <s2 title="Configuraton of cocoon.xconf">
        <p>Edit <code>cocoon.xconf</code>
        </p>
<source><![CDATA[
...
<event-pipeline class="org.apache.cocoon.components.profiler.\
  ProfilingNonCachingEventPipeline"/>  
<sax-connector class="org.apache.cocoon.components.profiler.\
  ProfilingSAXConnector"/>
...
<profiler/>
]]></source>
    </s2>
    <s2 title="Configuration sitemap.xmap">
      <p>Edit <code>sitemap.xmap</code>
      </p>
<source><![CDATA[
  <map:generators default="file">
    ...
    <map:generator  name="profile"
     src="org.apache.cocoon.components.profiler.ProfilerGenerator" 
label="content"/>
    </map:generators>  ...
  
  <map:match pattern="profile">
  <map:generate type="profile"/>
  <map:transform type="xslt" src="stylesheets/system/profile2html.xsl"/>
  <map:serialize/>
  </map:match>
]]></source>
    </s2>
      <p>
        You may try <code>http://localhost/cocoon/profile</code>
        several times.
      </p>
    </s1>
    <s1 title="Configuration">
      <p>The following parameter can be specified in the pipeline for 
         the generate command:
      </p>
      <ul>
        <li>
          sort (optional) : Sets how Profile Generator sorts 
          pipeline elements. You may set <code>sort</code> to 
<code>uri</code>
          to sort <code>pipeline</code> element by its <code>uri</code> 
attribute, 
          setting <code>sort</code> to time sorts 
          <code>pipeline</code> elements by its <code>time</code> 
attribute, 
          finally setting <code>sort</code> to count sorts 
<code>pipeline</code> elements
          by its <code>count</code> attribute. 
        </li>
      </ul>
    </s1>
    <s1 title="DTD">
      <p>XML generated by status generator uses namespace 
        <code>http://apache.org/cocoon/status/2.0</code>. The DTD of XML
        generated by status generator:
      </p>
<source><![CDATA[
<!ELEMENT profilerinfo (pipeline)*>
<!ATTLIST profilerinfo
  date CDATA #IMPLIED
>

<!ELEMENT pipeline (average, result)*>
<!ATTLIST pipeline
  uri CDATA #REQUIRED
  count CDATA #REQUIRED
  time CDATA #REQUIRED
>
<!ELEMENT average (element)*>
<!ATTLIST average
  time CDATA #REQUIRED
>

<!ELEMENT result (element)*>
<!ATTLIST result
  time CDATA #REQUIRED
>

<!ELEMENT element EMPTY>
<!ATTLIST element
  role CDATA #REQUIRED
  source CDATA #IMPLIED
  time CDATA #REQUIRED
>

]]></source>
    </s1>
    <s1 title="Example">
      <p>The profile generator may output information:
      </p>
<source><![CDATA[
<profilerinfo xmlns="http://apache.org/cocoon/profiler/1.0" 
  date="01.09.2001 21:50:00">
  <pipeline uri="welcome" count="1" time="481">
    <average time="481">
      <element role="file" source="docs/samples/samples.xml" 
time="250"/>
      <element role="xslt" source="stylesheets/simple-samples2html.xsl" 
time="171"/>
      <element role="org.apache.cocoon.serialization.HTMLSerializer" 
time="60"/>
    </average>
    <result time="481">
      <element role="file" source="docs/samples/samples.xml" 
time="250"/>
      <element role="xslt" source="stylesheets/simple-samples2html.xsl" 
time="171"/>
      <element role="org.apache.cocoon.serialization.HTMLSerializer" 
time="60"/>
    </result>
  </pipeline>
  <pipeline uri="profile" count="1" time="3355">
    <average time="3355">
      <element role="profile" time="2964"/>
      <element role="xslt" source="stylesheets/system/profile2html.xsl" 
time="180"/>
      <element role="org.apache.cocoon.serialization.HTMLSerializer" 
time="211"/>
    </average>
    <result time="3355">
      <element role="profile" time="2964"/>
      <element role="xslt" source="stylesheets/system/profile2html.xsl" 
time="180"/>
      <element role="org.apache.cocoon.serialization.HTMLSerializer" 
time="211"/>
    </result>
  </pipeline>
</profilerinfo>
]]></source>
    </s1>
  </body>
</document>
