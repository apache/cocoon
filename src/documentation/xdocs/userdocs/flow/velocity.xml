<?xml version='1.0' encoding='ISO-8859-1'?>
<!--
  Copyright 1999-2004 The Apache Software Foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.0//EN" "../../dtd/document-v10.dtd">
<document>
 <header>
  <title>Advanced Control Flow</title> 
  <authors>
   <person name="Christopher Oliver" email="coliver@apache.org" />
   <person name="Ovidiu Predescu" email="ovidiu@apache.org" />
  </authors>
 </header>
 <body>
  <s1 title="Velocity Generator">
   <p>If called from a Flowscript, the Cocoon
    <link href="http://jakarta.apache.org/velocity">Velocity</link>
    <link href="../generators/velocity-generator.html">Generator</link>
    provides access to the immediate properties of the context object passed to
    <link href="api.html#sendPage"><code>cocoon.sendPage</code></link> and
    <link href="api.html#sendPageAndWait"><code>cocoon.sendPageAndWait</code></link>. In addition, the current <link href="api.html#WebContinuation"><code>WebContinuation</code></link>
    is also available as a variable named <code>$continuation</code>. You would typically access
    its <code>id</code>:</p>
   <source>
  &lt;form action="$continuation.id"&gt;
   </source>
   <p>You can also reach previous continuations by using the <code>getParent()</code> function:</p>
   <source>
  &lt;form action="$continuation.getParent().id" &gt;
   </source>
   <p>In addition the following implicit objects are always available in the Velocity context:</p>
   <dl>
    <dt><link href="../../../apidocs/org/apache/cocoon/environment/Request.html">Request</link> <code>$request</code> </dt>
    <dd>The current Cocoon request</dd>
    <dt><link href="../../../apidocs/org/apache/cocoon/environment/Response.html">Response</link> <code>$response</code> </dt>
    <dd>The Cocoon response associated with the current request</dd>
    <dt><link href="../../../apidocs/org/apache/cocoon/environment/Session.html">Session</link> <code>$session</code> </dt>
    <dd>The Cocoon session associated with the current request</dd>
    <dt><link href="../../../apidocs/org/apache/cocoon/environment/Context.html">Context</link> <code>$context</code> </dt>
    <dd>The Cocoon context associated with the current request</dd>
    <dt><code>org.apache.avalon.framework.parameters.Parameters</code> <code>$parameters</code> </dt>
    <dd>Any parameters passed to the generator in the pipeline</dd>
   </dl>
   <p>
   Cocoon installs a Velocity introspector that makes it possible for you
   to access JavaScript objects and arrays in your templates, as well as Java objects. For example, assuming you had a Flowscript like this:</p>
   <source>
    sendPage("myTemplate.vm", {colors: ["red", "blue", "yellow"]});
   </source>
   <p>
    You could do this in <code>myTemplate.vm</code>:</p>
    <source>
    &lt;select name="colors"&gt;
    #foreach ($color in $colors) 
      &lt;option value="$color"&gt;$color&lt;/option&gt;
    #end
    &lt;/select&gt;
    </source>
  </s1>
 </body>
</document>
