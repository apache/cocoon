<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.0//EN" "../../dtd/document-v10.dtd">

<document>
  <header>
    <title>Offline Page Generation with the Command Line Interface</title>
    <version>0.9</version>
    <type>Technical document</type>
    <authors><person name="Upayavira" email="upayavira@apache.org"/>
    </authors>
    <abstract>This document explains how to use the Cocoon Command Line Interface for offline page and site generation.</abstract>
  </header>
  <body>
    <s1 title="Overview">
      <p>The Command Line Interface provides access to Cocoon's offline generation capabilities.</p>
      <p>This page gives details of how configure and use the CLI. Details of the concepts behind
         offline page generation are given on the offline generation 
         <link href="index.html">overview</link> page.</p>
    </s1>
    <s1 title="Invoking the CLI">
      <p>The CLI can be invoked from the command line. Change to the root directory of your 
         Cocoon distribution, and then, on Unix use: <code>./cocoon.sh cli &lt;parameters&gt;</code> 
         and on Windows use <code>cocoon.bat cli &lt;parameters&gt;</code></p>
      <p>The relevant parameters are detailed in the following sections.</p>
    </s1>
    <s1 title="Configuring the CLI">
      <p>The CLI has two methods of configuration, with an <code>xconf</code> file, and using 
         command line parameters.</p>
      <p>The <code>xconf</code> method is the newer, and gives access to a wider range of 
         features, and is thus explained first.</p>
      <note>Whilst the xconf method provides access to more features, the command line 
            parameter method is more stable, as there are currently plans to improve
            the xconf format to allow greater flexibility. If you require a stable and
            consistent method for accessing the CLI, it is recommended that you use the 
            command line parameter method.</note>
      <s2 title="Using an Xconf file">
        <p>To start the CLI using an xconf file, on Unix do <code>./cocoon.sh cli -x &lt;xconf file&gt;</code>
           or on Windows: <code>cocoon cli -x &lt;xconf file&gt;</code>.</p>
        <p>A sample xconf file is included below.</p>
        <source>
<![CDATA[
<?xml version="1.0"?>
<!--+
    |  This is the Apache Cocoon command line configuration file. 
    |  Here you give the command line interface details of where
    |  to find various aspects of your Cocoon installation.
    |
    |  If you wish, you can also use this file to specify the URIs
    |  that you wish to generate.
    |
    |  The current configuration information in this file is for
    |  building the Cocoon documentation. Therefore, all links here 
    |  are relative to the build context dir, which, in the build.xml 
    |  file, is set to ${build.context} 
    |
    |  Options:
    |    verbose:            increase amount of information presented
    |                        to standard output (default: false)
    |    follow-links:       whether linked pages should also be 
    |                        generated (default: true)
    |    precompile-only:    precompile sitemaps and XSP pages, but 
    |                        do not generate any pages (default: false)
    |    confirm-extensions: check the mime type for the generated page
    |                        and adjust filename and links extensions
    |                        to match the mime type 
    |                        (e.g. text/html->.html)
    +-->
    
<cocoon verbose="true"  
        follow-links="true" 
        precompile-only="false" 
        confirm-extensions="false">

   <!--+
       | Broken link reporting options:
       |   Report into a text file, one link per line:
       |     <broken-links type="text" report="filename"/>
       |   Report into an XML file:
       |     <broken-links type="xml" report="filename"/>
       |   Ignore broken links (default):
       |     <broken-links type="none"/>
       |   When a page includes an error, should a page be generated?
       |     
       |   Two attributes to this node specify whether a page should
       |   be generated when an error occured. 'generate' specifies 
       |   whether a page should be generated (default: true) and
       |   extension specifies an extension that should be appended
       |   to the generated page's filename (default: none)
       |     <broken-links generate="true" extension=".error.txt"/>
       |
       +-->
   <broken-links type="xml" 
                 file="brokenlinks.xml"
                 generate="false"
                 extension=".error"/>
   
   <!--+
       |  Load classes at startup. This is necessary for generating
       |  from sites that use SQL databases and JDBC.
       |  The <load-class> element can be repeated if multiple classes
       |  are needed.
       +-->
   <!--
   <load-class>org.firebirdsql.jdbc.Driver</load-class>
   -->

   <!--+
       |
       +-->
   <logging log-kit="WEB-INF/logkit.xconf" logger="cli" level="ERROR" />

   <!--+
       |  The context directory is usually the webapp directory
       |  containing the sitemap.xmap file.
       |
       |  The config file is the cocoon.xconf file.
       |
       |  The work directory is used by Cocoon to store temporary
       |  files and cache files.
       |  
       |  The destination directory is where generated pages will
       |  be written (assuming the 'simple' mapper is used)
       +-->
   <context-dir>.</context-dir>
   <config-file>WEB-INF/cocoon.xconf</config-file>
   <work-dir>work/docs</work-dir>
   <dest-dir>dest</dest-dir>

   <!--+
       | Specifies the filename to be appended to URIs that
       | refer to a directory (i.e. end with a forward slash).
       +-->
       
   <default-filename>index.html</default-filename>

   <!--+
       |  Specifies a user agent string to the sitemap when
       |  generating the site.
       +-->
   
   <!--
   <user-agent>xxx</user-agent>
   -->

   <!--+
       |  Specifies an accept string to the sitemap when generating
       |  the site.
       +-->
       
   <accept>*/*</accept>
   
   <!--+
       |  Specifies the URIs that should be generated (using <uri>
       |  elements, and (if necessary) what should be done with the
       |  generated pages.
       |
       |  The old behaviour - appends uri to the specified destination
       |  directory (as specified in <dest-dir>):
       |
       |   <uri>documents/index.html</uri>
       |
       |  Append: append the generated page's URI to the end of the 
       |  source URI:
       |
       |   <uri type="append" src-prefix="documents/" src="index.html"
       |   dest="build/dest/"/>
       |
       |  Replace: Completely ignore the generated page's URI - just 
       |  use the destination URI:
       |
       |   <uri type="replace" src-prefix="documents/" src="index.html" 
       |   dest="build/dest/docs.html"/>
       |
       |  Insert: Insert generated page's URI into the destination 
       |  URI at the point marked with a * (example uses fictional 
       |  zip protocol)
       |
       |   <uri type="insert" src-prefix="documents/" src="index.html" 
       |   dest="zip://*.zip/page.html"/>
       |
       +-->
   <uri>favicon.ico</uri>
   <uri type="append" src-prefix="documents/" src="index.html" dest="docs/"/>

   <!--+
       |  File containing URIs (plain text, one per
       |  line).
       +-->
  
   <!--
   <uri-file></uri-file>
   -->
   
</cocoon>
]]>
        </source>
        <s3 title="Broken Link Handling">
        <p>The xconf method allows for more sophisticated broken link handling. The
             user can select to have broken links reported to a file, this file being
             either text or XML.</p>
            <p>When this file is plain text, it will have one link URI per line.</p>
          <p>When this file is in XML, it will detail a message explaining the reason
             for the broken link, as well as the URI of the link.</p>
          <p>It is also possible to specify whether an error page should be generated 
             in the place of the broken page (based upon the configured 
             <code>&lt;map:handle-errors&gt;</code> code in the sitemap). If required,
             an extension can be appended to the original file's URI to signify that
             it is an error page (e.g. <code>.error</code>).</p>
        </s3>
      </s2>
      <s2 title="Command Line Parameters">
        <p>You can get a listing of the available parameters on unix with 
        <code>./cocoon.sh cli -h</code> or on Windows with <code>cocoon cli -h</code>.
        This should give a listing something like:</p>
        <source>
-------------------- Executing -----------------
Main Class: org.apache.cocoon.Main
usage: cocoon cli [options] [targets]
------------------------------------------------------------------------
cocoon 2.1
Copyright (c) 1999-2003 Apache Software Foundation. All rights reserved.
------------------------------------------------------------------------
 -a,--userAgent            use given string for user-agent header
 -e,--confirmExtensions    confirm that file extensions match mime-type of
                           pages and amend filename accordingly (default is true)
 -C,--configFile           specify alternate location of the configuration
                           file (default is ${contextDir}/cocoon.xconf)
 -D,--defaultFilename      specify a filename to be appended to a URI when
                           the URI refers to a directory
 -L,--loadClass            specify a class to be loaded at startup
                           (specifically for use with JDBC). Can be used multiple times
 -P,--precompileOnly       generate java code for xsp and xmap files
 -V,--verbose              enable verbose messages to System.out
 -b,--brokenLinkFile       send a list of broken links to a file (one URI
                           per line)
 -c,--contextDir           use given dir as context
 -d,--destDir              use given dir as destination
 -f,--uriFile              use a text file with uris to process (one URI
                           per line)
 -h,--help                 print this message and exit
 -k,--logKitconfig         use given file for LogKit Management
                           configuration
 -l,--Logger               use given logger category as default logger for
                           the Cocoon engine
 -p,--accept               use given string for accept header
 -r,--followLinks          process pages linked from starting page or not
                           (boolean argument is expected, default is true)
 -u,--logLevel             choose the minimum log level for logging
                           (DEBUG, INFO, WARN, ERROR, FATAL_ERROR) for startup logging
 -v,--version              print the version information and exit
 -w,--workDir              use given dir as working directory
 -x,--xconf                specify a file containing XML configuration
                           details for the command line interface
Note: the context directory defaults to './webapp'
        </source>
        <p>For details of the meaning of each specific parameter, see the <link href="index.html">overview</link>
           page.</p>
        <s3 title="Specifying Targets">
          <p>The command line parameter method does not have access to all of Cocoon's URI handling features. However,
             it is possible to specify multiple URIs to be crawled, all of which will be written to the same destination,
             and that destination (specified by the <code>-d</code> or <code>--destDir</code> option, may be a file URI
             or any other protocol for which a ModifiableSource exists (e.g. FTP).</p>
        </s3>
        <s3 title="URI Files">
          <p>A URI file offers a simple way to specify multiple URIs. The file is treated as one URI per line.</p>
        </s3>
        <s3 title="Broken Link Handling">
          <p>If a broken link file is specified, all broken links will be written to this file, in text format,
             one URI per line.</p>
        </s3>
      </s2>
    </s1>
  </body>
</document>

