<?xml version="1.0"?>
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

    <!-- =========================== Components ================================ -->
    <map:components>
        <map:generators default="file"/>
        
        <map:transformers default="xslt">
            <!-- Configure i18n transformer -->
            <map:transformer name="i18n" logger="sitemap.transformer.i18n" 
                src="org.apache.cocoon.transformation.I18nTransformer">
                <catalogues default="messages">
                  <catalogue id="messages" name="messages" location="translations"/>
                  <catalogue id="menu" name="menu" location="translations"/>
                </catalogues>
                <cache-at-startup>true</cache-at-startup>
            </map:transformer>
        </map:transformers>
        
        <map:readers default="resource"/>
        <map:serializers default="html"/>
        <map:selectors default="browser"/>
        <map:matchers default="wildcard"/>
    
        <!-- =========================== Actions ================================= -->   
        <map:actions>
            <!-- LocaleAction is used to set/get current users locale. See Javadocs for details. -->
            <map:action name="locale" logger="sitemap.action.locale" src="org.apache.cocoon.acting.LocaleAction">
                <!-- Creates a new session if needed. Used with 'store-in-session' param -->
                <create-session>true</create-session>
                <!-- Stores locale information in session. A session should be created before, 
                       otherwise 'create-session' should be true.
                -->
                <store-in-session>true</store-in-session>
                <!-- Stores locale information in request attributes -->             
                <store-in-request>true</store-in-request>
                <!-- Stores locale information in a client cookie -->             
                <store-in-cookie>false</store-in-cookie>
            
                <!-- Uncomment as needed to override defaults:
                <locale-attribute>locale</locale-attribute>
                <language-attribute>language</language-attribute>
                <country-attribute>country</country-attribute>
                <variant-attribute>variant</variant-attribute>
                -->
            </map:action>
        </map:actions>
    </map:components>

    <!-- =========================== Resources =============================== -->
    <map:resources>
        <!-- This resource is used to create a composite page from menu and content -->
        <map:resource name="composite">
            <map:aggregate element="site">
                <map:part src="cocoon:/menu/{../0}"/>
                <map:part src="cocoon:/content/{../0}" label="content"/>
            </map:aggregate>
            <map:transform src="site2html.xsl">
                <map:parameter name="page" value="{../0}" />
                <map:parameter name="locale" value="{../../locale}" />                
            </map:transform>
            <map:serialize/>
        </map:resource>
    </map:resources>

    <!-- =========================== Pipelines ================================= -->
    <map:pipelines>
        <!-- Locale aware content generation pipeline -->            
        <map:pipeline>
            <map:act type="locale">
            
                <!-- Default pipeline -->
                <map:match pattern="">
                    <map:redirect-to uri="simple.xml"/>
                </map:match>
            
                <!-- Generate static output (simple.xml) -->
                <map:match pattern="*.xml">
                    <map:call resource="composite" />
                </map:match>
            
                <!-- Generate dynamic output (simple.xsp) -->            
                <map:match pattern="*.xsp">
                    <map:call resource="composite" />
                </map:match>                
                
                <!-- A helper matcher for static content translation and generation -->
                <map:match pattern="content/*.xml">
                        <map:generate src="{1}.xml"/>
                        <map:transform type="i18n">
                            <map:parameter name="locale" value="{../locale}"/>
                        </map:transform>
                        <map:transform src="simple.xsl"/>
                        <map:serialize/>
                </map:match>
            
                <!-- A helper matcher for dynamic content translation and generation -->
                <map:match pattern="content/*.xsp">
                        <map:generate type="serverpages" src="{1}.xsp"/>
                        <map:transform type="i18n">
                            <map:parameter name="locale" value="{../locale}"/>
                        </map:transform>
                        <map:transform src="simple.xsl"/>
                        <map:serialize/>
                </map:match>
    
                <!-- Menu generation -->
                <map:match pattern="menu/*">
                        <map:generate src="menu.xml"/>
                        <map:transform type="i18n">
                            <!-- Override default catalogue for this pipeline -->
                            <map:parameter name="default-catalogue-id" value="menu"/>
                            <map:parameter name="locale" value="{../locale}"/>
                        </map:transform>
                        <map:transform src="menu2html.xsl">
                            <map:parameter name="locale" value="{../locale}" />
                            <map:parameter name="page" value="{1}" />
                        </map:transform>
                        <map:serialize/>
                </map:match>
            </map:act>
        </map:pipeline>                
               
        <!-- General purpose pipeline  -->        
        <map:pipeline>
            
            <!-- Display this sitemap source-->
            <map:match pattern="sitemap.xmap">
                <map:generate src="sitemap.xmap"/>
                <map:transform src="context://stylesheets/system/xml2html.xslt"/>
                <map:serialize/>
            </map:match>            
            
            <map:match pattern="*.css">
                <map:read src="{1}.css" mime-type="text/css"/>
            </map:match>
            
            <map:match pattern="images/*.gif">
                <map:read src="images/{1}.gif" mime-type="image/gif"/>
            </map:match>
        </map:pipeline>
        
    </map:pipelines>
    
</map:sitemap>

