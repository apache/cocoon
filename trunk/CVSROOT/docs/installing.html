<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>

<head>
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<meta NAME="Author" CONTENT="Stefano Mazzocchi">
<title>Cocoon - Installing</title>
</head>

<body BGCOLOR="#FFFFFF">

<p><img src="images/logo.gif" border="0"></p>

<h1 align="center">Installing Cocoon</h1>

<h2>System Requirements</h2>

<blockquote>
  <ul>
    <li><strong>Server API 2.x Servlet Engine</strong><br>
      Being a 100% pure Java servlet, Cocoon should run on any 2.x compliant servlet platform.
      Cocoon has been designed, developed and tested under the Apache JServ servlet engine but
      the lack of proprietary features should allow you to make it work on any Servlet 2.x
      compliant servlet engine. Please, file in a bug report with the most detailed information
      if Cocoon fails to run on your servlet platform.</li>
    <li><strong>XML Parser with DOM support</strong><br>
      Cocoon uses the W3C Document Object Model to specify the documents it handles and it's not
      based on any particular XML parser implementation using a modular and pluggable interface.
      These are the XML parsers currently supported:<ol>
        <li><a href="http://www.openxml.org/">OpenXML</a></li>
        <li><a href="http://www.alphaworks.ibm.com/">IBM XML4J</a></li>
        <li><a href="http://developer.java.sun.com/">Sun ProjectX</a></li>
        <li><a href="http://www.oracle.com/xml/">Oracle XML Parser v.2</a></li>
      </ol>
    </li>
    <li><strong>XSL Processor with DOM support</strong><br>
      These are the XSL processors currently supported:<ol>
        <li><a href="http://www.clc-marketing.com/xslp/">XSL:P Processor</a></li>
        <li><a href="http://www.alphaworks.ibm.com/">Lotus XSL Processor</a></li>
        <li><a href="http://www.oracle.com/xml/">Oracle XSL Processor</a> (comes
          with the Oracle XML parser v.2)</li>
        <li><a href="http://www.jclark.com">James Clark's XT processor</a></li>
      </ol>
    </li>
  </ul>
</blockquote>

<h2>Installing Cocoon</h2>

<blockquote>
  <p>Cocoon is a 100% pure Java servlet based on the <a
  href="http://java.sun.com/products/servlets/index.html">JavaSoft Servlet API platform</a>,
  for this reason it should work on any servlet engine that is compliant at least with the
  2.0 version of the specification.</p>
  <p>First thing to do is to install the servlet in your servlet engine. Since the Servlet
  API specification does not (yet) define a standard way to install a servlet, you should
  refer to your servlet engine instructions on how to do this. If your servlet engine
  supports jar files, we suggest you to install the <font color="#FF0000"><code>cocoon.jar</code></font>
  file that you find in the /bin/ directory of the distribution. Please, note that you must
  also make visible all the other jar archives that are needed to the servlet (and
  found in the /bin/ directory of the distribution).</p>
  <p>Once the servlet is installed, you should tell Cocoon where its configuration file
  resides setting the <font color="#FF0000"><code>properties</code></font> initialization
  argument for the Cocoon servlet (a template configuration file is found both
  in the /bin/ directory of the distribution and packaged inside the cocoon.jar
  file in the directory org/apache/cocoon/). Again, there is no standard way
  (yet!) on how to do this, but
  all compliant servlet engine must be able to pass initialization arguments to servlets.
  So, if you don't find a way to do this, look again or contact your servlet engine
  provider.</p>
  <p>At this point, you should map the &quot;.xml&quot; extension (note that
  Cocoon may not work correctly if another extension is used) to the <font color="#FF0000"><code>org.apache.cocoon.Cocoon</code></font>
  servlet. For the last time, you should follow your servlet engine instructions
  on how to do this.</p>
  <p>At this point, any &quot;.xml&quot; file will be processed by Cocoon and the resulting
  output will be delivered to the client. Please note that XML files should contain a
  reference to their XSL stylesheet in order to be correctly processed. Otherwise, the XML
  will be processed but will be delivered without any particular style. This can be used in
  XSL aware clients. See the <a href="guide.html">user guide</a> for more information
  on
  this.</p>
</blockquote>

<h3><b>Installing on <a href="http://java.apache.org/jserv/index.html">Apache
JServ</a></b></h3>

<blockquote>
  <p><b><font color="#FF0000">NOTE: a bug in Apache JServ 1.1b1 and 1.1b2
  prevents Cocoon from operating correctly. The problem is fixed from version
  1.1b3 on.</font></b></p>
</blockquote>

<blockquote>
  <p>Installation on Apache JServ is simple and straightforward. For
  out-of-the-box usage, you have to add the all the jar packages found in the
  /bin/ directory of the distribution in Apache JServ classpath adding the
  following lines to your <code>jserv.properties</code> file or making them
  available in the system classpath (if you're running Java2, it's enough if you
  move them in your extension directory):</p>
  <blockquote>
    <div align="left">
      <pre><font color="#0000FF">wrapper.classpath=&lt;cocoon&gt;/bin/xxx.jar</font></pre>
    </div>
  </blockquote>
  <p align="left">where <code>&lt;cocoon&gt;</code> is the directory where you
  installed cocoon and for every package found in that /bin/ directory (<b>all
  but the cocoon.jar file, since Cocoon could behave incorrectly if placed there</b>). Then
  you should add the Cocoon servlet to your favorite servlet zone, adding the
  following line to your <code>&lt;zone&gt;.properties</code> file, where <code>&lt;zone&gt;</code>
  is the name of the servlet zone as you should normally do with Apache JServ:</p>
  <blockquote>
    <div align="left">
      <pre><font color="#0000FF">repositories=&lt;cocoon&gt;/bin/cocoon.jar</font></pre>
    </div>
  </blockquote>
  <p>At this point, the servlet engine knows where to locate the Cocoon servlet
  (org.apache.cocoon.Cocoon) but Cocoon must need to know its configurations to
  be able to start. To configure Cocoon, you must pass the <code>cocoon.properties</code>
  file location to the servlet by adding the following to the <code>&lt;zone&gt;.properties</code>
  file:</p>
  <blockquote>
    <pre><font color="#0000FF">servlet.org.apache.cocoon.Cocoon.initArgs=properties=&lt;cocoon&gt;/bin/cocoon.properties</font></pre>
  </blockquote>
  <p>Note that you find a template cocoon.properties file in the /bin/ directory
  or packaged inside the cocoon.jar file. To run the examples found in the
  /example/ directory of the distribution you should don't need to change
  anything of this file.</p>
  <p>Now your cocoon servlet is properly configured, but you should tell Apache
  to direct any call to an XML file (or any other file you want Cocoon to
  process) to the Cocoon servlet. To do this, you should add the following line
  to your Apache <code>conf</code> files where you placed the other <code>mod_jserv</code>
  directives (usually <code>httpd.conf</code> or <code>mod_jserv.conf</code>)
  where <code>/servlet/</code> is the URI mapped to the servlet zone where
  Cocoon resides.</p>
  <blockquote>
    <pre><font color="#0000FF">ApJServAction .xml /servlet/org.apache.cocoon.Cocoon</font></pre>
  </blockquote>
  <p>At this point everything should be configured fine. Browse the <code>/example/index.html</code>
  file from your web server to see Cocoon in action.</p>
</blockquote>

  <h3>Installing on <a href="http://commerce.allaire.com/download/">Allaire JRun
  2.3.3</a></h3>
<blockquote>
  <p>Download JRun 2.3.3 and then get the <a href="http://www2.allaire.com/products/Jrun/MoreInformation/ProductUpdates.cfm"> build 155 patch</a>
  so you have the latest and greatest version.  Install it and run the connector wizard to install a connector for your native web server.</p>
  <blockquote>
    <p>Special notes for Linux users:</p>
    <ul>
      <li>If you have JRun from the RPM on RedHat 6.1 PowerTools CD you have build 154, which had a serious bug with repeated buffer being appended
        to output over a certain size (about 14KB).</li>
      <li>If you are using JRun with an IBM JDK/JRE on Linux, check your CPU percent of usage, using either the GNOME CPU/MEM monitor applet, top,
        xosview or a similar utility.  It is common for the kernel to go into a spin with JRun and the IBM JRE/JDKs.  To fix this, edit the
        endpoint.properties files in<br>
        /jrun/jsm-default/properties/services/[jcp][jws] so that the endpoint.main.class property reads:<br>
        endpoint.main.class=com.livesoftware.jrun.service.TcpServiceEndpoint2 [i.e., add a 2 to the end of the original line.]  Then restart JRun to
        read in the new properties.</li>
    </ul>
  </blockquote>
  <p>Download Cocoon to unjar it in your favorite location.</p>
  <p>Copy or move the <code> docs/example/</code> directories and index.html file to
  your web server's document root or create an alias for them to be visible from
  your favorite location.</p>
  <p>Edit JRun's properties files to use the Cocoon servlet and its provided jar files.  You can do these steps using the GUI
  Admin.<br>
  Application, but I think it's easier to just edit the files "by hand."</p>
  <ul>
    <li>Edit <b>/jrun/jsm-default/properties/jsm.properties</b>:<br>
      You must edit the java.classpath property in jsm.properties so that you remove the path to IBM's xml4j parser (for now that is, i.e., if you want to use it or another parser later you edit the cocoon.properties file (in /jrun/lib/bin if you're following this so far) and then edit the JRun classpath
      accordingly).  Specifically, add the paths to the four jar files in /jrun/lib/bin.  While you're at it, if you're into simplicity and you don't intend to use WebL or the instantdb example or cfanywhere, you may want to remove some of those jar files from the classpath.  An edited, fairly bare bones java.classpath might look like (on Linux):<br>
      <br>
      <code><font color="#0000FF">java.classpath=/usr/jre118/lib/rt.jar:/usr/jre118/lib/i18n.jar:/usr/local/jrun/./lib/jrun.jar:/usr/local/jrun/./lib/servlet.jar:/usr/local/jrun/./lib/jsp.jar:/usr/local/jrun/./lib/xt.jar:/usr/local/jrun/./lib/fesi.jar:/usr/local/jrun/./lib/jrunadmin/jrunadmin.jar:/usr/local/jrun/./classes:/usr/local/jrun/./jsm-default/classes:/usr/local/jrun/./lib/jrunadmin/swing.jar:/usr/local/jrun/lib/bin/Cocoon.jar:/usr/local/jrun/lib/bin/openxml.106.jar:/usr/local/jrun/lib/xslp.19990832.jar:/usr/local/jrun/lib/bin/fop.091.jar<br>
      </font></code></li>
    <li>Edit <b> /jrun/jsm-default/services/jse/properties/rules.properties</b>:<br>
      Add a mapping for XML files like so:<br>
      <br>
      <code><font color="#0000FF">*.xml=cocoon<br>
      </font></code></li>
    <li>Edit <b> /jrun/jsm-default/services/jse/properties/servlets.properties</b>:<br>
      Add the following lines to the end of the file to create an alias for the Cocoon servlet:<br>
      <br>
      <code><font color="#0000FF">servlet.cocoon.code=org.apache.cocoon.Cocoon<br>
      servlet.cocoon.args=properties=/usr/local/jrun/lib/bin/cocoon.properties<br>
      servlet.cocoon.preload=false<br>
      </font></code></li>
    <li>Edit and rename some files and directories in the example/ directory to make them compatible with the way JRun reads and interprets
      URLs:
      <ul>
        <li>Rename example/java.apache.org/ to example/news or example/java_apache_org, or as you like it.  JRun interprets the<br>
          java.apache.org directory name as a package directory structure, so you
          have to rename it.  Change the relevant URL in example/index.html file
          to correspond to the new directory name.</li>
        <li>Rename example/fo/fo.test.xml to example/fo/fotest.xml or what you will.  Again, the extra period in the filename makes JRun think it
          should be looking into a Java package directory structure. Edit the URL
          in example/index.html accordingly.</li>
        <li>Restart JRun and your native web server (the latter is necessary to load the new rules.properties mapping to the JRun connector--the native
          piece running in process with the web server).</li>
      </ul>
    </li>
  </ul>
  <p>Go to <a href="http://127.0.0.1/example/index.html">http://127.0.0.1/example/index.html</a>
  and enjoy!</p>
</blockquote>
<h2><b>Working Systems</b></h2>
<blockquote>
  <p>Cocoon has been reported to be working on these systems:</p>
  <ul>
    <li>RedHat Linux 6.0 + Apache 1.3.9 + Apache JServ 1.0 + IBM JDK 1.1.8</li>
    <li>RedHat Linux 6.0 + Apache 1.3.9 + Apache JServ 1.1b3 + IBM JDK 1.1.8</li>
    <li>Windows 98 + Apache 1.3.9 + Apache JServ 1.0 + IBM JDK 1.1.7</li>
    <li>Windows 98 + Apache 1.3.9 + Apache JServ 1.1b3 + IBM JDK 1.1.7</li>
    <li>Windows 98 + Apache 1.3.9 + Apache JServ 1.0 + Sun JDK 1.2.2</li>
    <li>Windows 98 + Apache 1.3.9 + Apache JServ 1.1b3 + Sun JDK 1.2.2</li>
    <li>Windows NT 4.0 + IIS + JRun 2.3.3 + Sun JDK 1.2.1</li>
    <li>RedHat Linux 6.1 + Apache 1.3.9 + JRun 2.3.3 + IBM JRE 1.1.8</li>
    <li>SunOS Netria 5.6 + Apache 1.3.9 + Apache JServ 1.1b3 + Sun JDK 1.1.7</li>
  </ul>
  <p><font color="#FF0000"><b>NOTE: due to a bug in <a href="http://www.blackdown.org">Blackdown
  JDK 1.2pre2</a> for Linux, you should use green threads only if you are using
  that JVM.</b></font></p>
  <p>Please, submit your feedback if you were able to install Cocoon on a
  different combination not listed above.</p>
</blockquote>

<p align="center"><font size="-1">Copyright (c) <a href="http://xml.apache.org">The Apache XML Project</a>.<br>
$Id: installing.html,v 1.1.1.1 1999-11-09 01:51:29 stefano Exp $<br>
All rights reserved.</font></p>
</body>
</html>
