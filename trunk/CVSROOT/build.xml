<?xml version="1.0"?>

<!-- ===================================================================

   Build file for Cocoon

Notes:
   This is a build file for use with the Jakarta Ant java build tool.
   
Installation Instructions:   
   To install Ant on your system, you need to checkout the
   "jakarta-tools" CVS module. Then you should place the files
     - ant.jar
     - projectx-tr2.jar
     - javac.jar
   in your classpath. (XML parser abstraction is currently in
   the todo list, volunteers welcome!)
   
Build Instructions:   
   To build, run
    
     java org.apache.tools.ant.Main
     
   on the directory where this file is located.

Authors:
  Stefano Mazzocchi <stefano@apache.org>
  
Fixme:
  - add "dist", "docs" and "samples" targets
  - design better package abstraction and build system
  - use token evaluation to keep versining info in this file only

Copyright:
  Copyright (c) 1999 The Apache Software Foundation.
  
   $Id: build.xml,v 1.3 1999-12-03 23:46:16 stefano Exp $
   
==================================================================== -->

<project default="package" basedir=".">

  <property name="name" value="Cocoon"/>
  <property name="version" value="1.6-dev"/>
  <property name="year" value="1999"/>

  <property name="build.compiler" value="classic"/>
  <property name="debug" value="off"/>
  
  <property name="src.dir" value="./src"/>
  <property name="docs.dir" value="./docs"/>
  <property name="sheets.dir" value="./stylesheets"/>
  <property name="images.dir" value="./resources"/>
  <property name="version.file" value="org/apache/cocoon/Defaults.java"/>
  
  <!-- this sucks! we should have a way to tell something like "org.apache.cocoon.*"
       let stupid javadoc do the job. I love javadoc's idea but I hate who
       wrote it. -->
  <property name="packages" value="org.apache.cocoon"/>

  <property name="build.dir" value="./build"/>
  <property name="build.src" value="./build/src"/>
  <property name="build.dest" value="./build/classes"/>
  <property name="build.docs" value="./build/docs"/>
  <property name="build.javadocs" value="./build/javadocs"/>

  <property name="dist.dir" value="./dist"/>

  <property name="site.dir" value="../xml-site/sources/cocoon"/>

  <target name="prepare">
    <!-- create temporary build dirs -->
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.src}"/>
    <mkdir dir="${build.dest}"/>
    <mkdir dir="${build.docs}"/>
    <mkdir dir="${build.javadocs}"/>

    <!-- copy src files dirs -->
    <copydir src="${src.dir}" dest="${build.src}"/>
    
    <!-- substitute tokens as needed ("replace" not yet implemented) -->
    <!-- <replace file="${build.src}/${version.file}" token="@version@" value="${version}"/> -->
  </target>

  <target name="compile" depends="prepare">
    <javac srcdir="${build.src}" destdir="${build.dest}" debug="${debug}"/>
  </target>

  <target name="javadocs" depends="prepare">
    <mkdir dir="${build.javadocs}"/>
    <copyfile src="${stylesheets}/javadoc.css" dest="{$build.javadocs}/stylesheet.css"/>
    <javadoc2 sourcepath="${build.src}" 
              destdir="${build.javadocs}"
              packagenames="${packages}"
              author="true" 
              version="true" 
              use="true"
              windowtitle="${name} API"
              doctitle="${name}"
              bottom="Copyright &#169; ${YEAR} Apache XML Project. All Rights Reserved."
    />
  </target>

  <target name="docs" depends="javadocs">
    <mkdir dir="${build.docs}"/>
    <!-- here should go the <stylebook > stuff -->
  </target>

  <target name="package" depends="compile">
    <jar jarfile="${build.dir}/${name}-${version}.jar" basedir="${build.dest}" manifest="${build.src}/MANIFEST.mf" items="org"/>
  </target>
  
  <target name="dist" depends="package, docs">
    <mkdir dir="${dist.dir}"/>
    
    <!-- yet to finish! -->
   
  </target>
  
  <target name="site">
    <copyfile src="${docs.dir}/book.xml" dest="${site.dir}/../cocoon.xml"/>
    <xslt src="${docs.dir}/index.xml" dest="${site.dir}/index-sbk.xml" sheet="${sheets.dir}/document-stylebook.xsl"/>
    <xslt src="${docs.dir}/installing.xml" dest="${site.dir}/installing-sbk.xml" sheet="${sheets.dir}/document-stylebook.xsl"/>
    <xslt src="${docs.dir}/cocoon2.xml" dest="${site.dir}/cocoon2-sbk.xml" sheet="${sheets.dir}/document-stylebook.xsl"/>
    <xslt src="${docs.dir}/dcpprocessor.xml" dest="${site.dir}/dcpprocessor-sbk.xml" sheet="${sheets.dir}/document-stylebook.xsl"/>
    <xslt src="${docs.dir}/sqlprocessor.xml" dest="${site.dir}/sqlprocessor-sbk.xml" sheet="${sheets.dir}/document-stylebook.xsl"/>
    <xslt src="${docs.dir}/license.xml" dest="${site.dir}/license-sbk.xml" sheet="${sheets.dir}/document-stylebook.xsl"/>
    <xslt src="${docs.dir}/javadoc.xml" dest="${site.dir}/javadoc-sbk.xml" sheet="${sheets.dir}/document-stylebook.xsl"/>
    <xslt src="${docs.dir}/guide.xml" dest="${site.dir}/guide-sbk.xml" sheet="${sheets.dir}/document-stylebook.xsl"/>
    <xslt src="${docs.dir}/technologies.xml" dest="${site.dir}/technologies-sbk.xml" sheet="${sheets.dir}/document-stylebook.xsl"/>
    <xslt src="${docs.dir}/dynamic.xml" dest="${site.dir}/dynamic-sbk.xml" sheet="${sheets.dir}/document-stylebook.xsl"/>
    <xslt src="${docs.dir}/faq.xml" dest="${site.dir}/faq-sbk.xml" sheet="${sheets.dir}/faq-stylebook.xsl"/>
    <xslt src="${docs.dir}/WD-xsp.xml" dest="${site.dir}/WD-xsp-sbk.xml" sheet="${sheets.dir}/spec-stylebook.xsl"/>
    <xslt src="changes.xml" dest="${site.dir}/changes-sbk.xml" sheet="${sheets.dir}/changes-stylebook.xsl"/>
    <xslt src="todo.xml" dest="${site.dir}/todo-sbk.xml" sheet="${sheets.dir}/todo-stylebook.xsl"/>
    <copydir src="${images.dir}" dest="${site.dir}/images"/>
  </target>            
                       
  <target name="clean">
    <deltree dir="${build.dir}"/>
    <deltree dir="${dist.dir}"/>
  </target>

</project>
